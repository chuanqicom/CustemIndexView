//
//  QueryResultsViewController.m
//  GFB
//
//  Created by xiebin on 16/9/23.
//  Copyright © 2016年 Vision Credit  Financial Technology Cpmpany Limited. All rights reserved.
//

#import "QueryResultsViewController.h"
#import "MButton.h"

@interface QueryResultsViewController ()

@property (weak,  nonatomic) IBOutlet UIView *bgView;
@property (strong,nonatomic) UIView          *popUpView;
@property (weak, nonatomic) IBOutlet MButton *queryBtn;

@end

@implementation QueryResultsViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    [self.view setBackgroundColor:COLOR(238, 238, 238, 1)];
    
    self.bgView.layer.cornerRadius = 10.f;
    self.bgView.layer.masksToBounds = YES;
    
    //配置数据
    [self configData];
}

- (NSString *)navigationTitle
{
    return @"查询结果";
}

#pragma mark - navigationBar 左边返回按钮点击事件
- (void)navLeftButtonAction
{
    [self.navigationController popToRootViewControllerAnimated:YES];
}

//配置数据
- (void)configData
{
    if (![[NSUserDefaults standardUserDefaults] boolForKey:@"TotalAmount"])
    {
        self.cityNameLb.text = _cityName;
        [[NSUserDefaults standardUserDefaults] setObject:_cityName forKey:@"CityName"];
        
        NSString *time = [NSString stringWithFormat:@"%@",self.queryResultModel.queryTime];
        NSDateFormatter * formatter = [[NSDateFormatter alloc]init];
        [formatter setDateFormat:@"yy-MM-dd"];
        NSDate * date = [formatter dateFromString:time];
        [formatter setDateFormat:@"yy,MM,dd"];
        NSString *timeStr = [formatter stringFromDate:date];

        self.timeLabel.text = [NSString stringWithFormat:@"查询时间：%@", timeStr];
        [[NSUserDefaults standardUserDefaults] setObject:timeStr forKey:@"QueryTime"];
        [[NSUserDefaults standardUserDefaults] synchronize];
        
        [[NSUserDefaults standardUserDefaults] setBool:YES forKey:@"TotalAmount"];
        self.tipLabel.text = @"已获取";
        self.monthAmount.text = [NSString stringWithFormat:@"%.2f", self.queryResultModel.monthAmount];
        self.totalAmount.text = [NSString stringWithFormat:@"%.2f", self.queryResultModel.totalAmount];
    }
    else
    {
        NSString *cityName = [[NSUserDefaults standardUserDefaults] objectForKey:@"CityName"];
        self.cityNameLb.text = cityName;
        
        NSString *queryTime = [[NSUserDefaults standardUserDefaults] objectForKey:@"QueryTime"];
        self.timeLabel.text = [NSString stringWithFormat:@"查询时间：%@", queryTime];
        
        self.tipLabel.text = @"为了您的信息安全，敏感信息已隐藏";
        self.monthAmount.text = [NSString stringWithFormat:@"* * *"];
        self.totalAmount.text = [NSString stringWithFormat:@"* * *"];
        
        [self.queryBtn setTitle:@"再次查看" forState:UIControlStateNormal];
    }
}


- (IBAction)providenFundInformationAgainButtonAction:(UIButton *)sender
{
    [[NSUserDefaults standardUserDefaults] setBool:NO forKey:@"TotalAmount"];
    
    [self.navigationController popToRootViewControllerAnimated:YES];
}

- (IBAction)deleteRecordButtonAction:(UIButton *)sender
{
    [UIView animateWithDuration:0.5 animations:^{
        self.popUpView = [[UIView alloc]initWithFrame:self.view.bounds];
        self.popUpView.backgroundColor = COLOR(153, 153, 153, 0.6);
        [self.view addSubview:self.popUpView];
        
        UIView *popView = [[UIView alloc]init];
        popView.backgroundColor = [UIColor whiteColor];
        popView.layer.cornerRadius = 10.f;
        popView.layer.masksToBounds = YES;
        [self.popUpView addSubview:popView];
        [popView mas_makeConstraints:^(MASConstraintMaker *make) {
            make.center.equalTo(self.popUpView);
            make.size.mas_equalTo(CGSizeMake(255, 300));
        }];
        
        UIImage *image = [UIImage imageNamed:@"Paper-shredder"];
        UIImageView *topImageView = [[UIImageView alloc]init];
        topImageView.image = image;
        [popView addSubview:topImageView];
        [topImageView mas_makeConstraints:^(MASConstraintMaker *make) {
            make.centerX.mas_equalTo(popView);
            make.top.equalTo(popView.mas_top).offset(30);
            make.size.mas_equalTo(CGSizeMake(image.size.width, image.size.height));
        }];
        
        UILabel *promptLb = [[UILabel alloc]init];
        [popView addSubview:promptLb];
        promptLb.text = @"删除记录";
        promptLb.textColor = MAIN_COLOR;
        promptLb.textAlignment = NSTextAlignmentCenter;
        promptLb.font = [UIFont systemFontOfSize:16];
        [promptLb mas_makeConstraints:^(MASConstraintMaker *make) {
            make.centerX.mas_equalTo(popView);
            make.top.equalTo(topImageView.mas_bottom).offset(20);
        }];
        
        UILabel *msgLb = [[UILabel alloc]init];
        [popView addSubview:msgLb];
        msgLb.text = @"删除后将不保留您的信息\n确定删除？";
        msgLb.numberOfLines = 0;
        msgLb.textColor = COLOR(102, 102, 102, 1);
        msgLb.textAlignment = NSTextAlignmentCenter;
        msgLb.font = [UIFont systemFontOfSize:16];
        [msgLb mas_makeConstraints:^(MASConstraintMaker *make) {
            make.centerX.mas_equalTo(popView);
            make.top.equalTo(promptLb.mas_bottom).offset(15);
        }];
        
        
        UIView *lineView1 = [[UIView alloc]init];
        lineView1.backgroundColor = COLOR(236, 236, 236, 1);
        [popView addSubview:lineView1];
        [lineView1 mas_makeConstraints:^(MASConstraintMaker *make) {
            make.centerX.mas_equalTo(popView);
            make.top.equalTo(popView.mas_bottom).offset(-50);
            make.size.mas_equalTo(CGSizeMake(241, 1));
        }];
        
        UIView *lineView2 = [[UIView alloc]init];
        lineView2.backgroundColor = COLOR(236, 236, 236, 1);
        [popView addSubview:lineView2];
        [lineView2 mas_makeConstraints:^(MASConstraintMaker *make) {
            make.centerX.mas_equalTo(popView);
            make.top.equalTo(lineView1.mas_bottom).offset(10);
            make.size.mas_equalTo(CGSizeMake(1, 30));
        }];
        
        NSArray *textArr = @[@"确定",@"取消"];
        for (NSInteger i = 0; i < textArr.count; i++)
        {
            UIButton *btn = [[UIButton alloc]initWithFrame:CGRectMake(i*127.5, 251, 127.5, 49)];
            [btn setTitle:textArr[i] forState:UIControlStateNormal];
            btn.titleLabel.font = [UIFont systemFontOfSize:15];
            btn.tag = 100+i;
            
            if (i == 0)
            {
                [btn setTitleColor:MAIN_COLOR forState:UIControlStateNormal];
            }
            else
            {
                [btn setTitleColor:COLOR(190, 190, 190, 1) forState:UIControlStateNormal];
            }
            
            [popView addSubview:btn];
            [btn addTarget:self action:@selector(promptedButtonAction:) forControlEvents:UIControlEventTouchUpInside];
        }
    }];

}


- (void)promptedButtonAction:(UIButton *)button
{
    switch (button.tag)
    {
        case 100:
        {
            [[NSUserDefaults standardUserDefaults] setBool:NO forKey:@"TotalAmount"];
            
            [self.navigationController popToRootViewControllerAnimated:YES];

            [self.popUpView removeFromSuperview];
        }
            break;
            
        case 101:
        {
            [self.popUpView removeFromSuperview];
        }
            break;
    }
}


- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event
{
    [self.popUpView removeFromSuperview];
}

@end
